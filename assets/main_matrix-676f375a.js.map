{"version":3,"file":"main_matrix-676f375a.js","sources":["../../src/matrix/main_matrix.ts"],"sourcesContent":["/// <reference types=\"@workadventure/iframe-api-typings\" />\n\nimport { ActionMessage, Area } from \"@workadventure/iframe-api-typings\";\nimport { ITiledMap } from '@workadventure/tiled-map-type-guard'\nimport { bootstrap } from \"./main\";\n\n// Adds a class to store each area's name and the associated properties\nclass areaobjects {\n    name!: string;\n    associatedlayers!: Array<string>;\n}\n\n// Array for all areas\nlet map!: ITiledMap;\nlet currareaprop: Array<areaobjects> = []\nlet triggerMessage!: ActionMessage;\n\n// Waiting for the API to be ready\nWA.onInit().then(async() => {\n    bootstrap()\n\n    map = await WA.room.getTiledMap()\n\n    hideAll()\n    getAreaObjects()\n    setAreaBehaviour()\n    displayOnArrival()\n    setExitPrompt()\n\n}).catch(e => console.error(e));\n\n// Used to grab all the relevant data for currareaprop :\n// Here, it is looking for an objectgroup named \"drawZones\" (line 59-60).\n// When it is found, it then looks through all the objects of the \"area\" class with (line 60-62) that also contain properties.\n// It then looks through the properties to look for the \"associatedLayer\" property with a non null value and a \"string type\" (line 64).\n// If all conditions are met, it is added to the list (line 65)\nfunction getAreaObjects() {\n    for (let Layer of map.layers) {\n        if (Layer.name === \"drawZones\" && Layer.type === \"objectgroup\") {\n            for (let i: number = 0; i < Layer.objects.length; i++) {\n                let properties = Layer.objects[i].properties\n                if (Layer.objects[i].class == \"area\" && properties != undefined) {\n                    for (let property of properties) {\n                        if (property.name === \"associatedLayer\" && property?.value != undefined && property.type === \"string\")\n                            currareaprop.push({name:Layer.objects[i].name, associatedlayers:property.value.split(\",\")})\n                    }\n                }\n            }\n            break\n        }\n    }\n}\n\n// Used to set the behaviour for each zone\nfunction setAreaBehaviour() {\n    for (let Zone of currareaprop) {\n        for (let Layers of Zone.associatedlayers) {\n            WA.room.area.onEnter(Zone.name).subscribe(() => {\n                WA.room.showLayer(Layers)\n            });\n            WA.room.area.onLeave(Zone.name).subscribe(() => {\n                WA.room.hideLayer(Layers)\n            });\n        }\n    }\n}\n\nfunction isInArea(player_x: number, player_y: number, Object: Area) {\n    if (Object.x < player_x && player_x < Object.x + Object.width && Object.y < player_y && player_y < Object.y + Object.height)\n        return true\n    return false\n}\n\nasync function displayOnArrival() {\n    let position = await WA.player.getPosition()\n    for (let Zone of currareaprop) {\n        let Object = await WA.room.area.get(Zone.name)\n        if (Object != undefined && isInArea(position.x, position.y, Object)) {\n            for (let Layers of Zone.associatedlayers) {\n                WA.room.showLayer(Layers)\n            }\n            return\n        }\n    }\n}\n\nfunction declarePrompt(layerName: string, url: string) {\n    WA.room.setProperty(\"ExitZones/\" + layerName, \"exitUrl\", undefined)\n    WA.room.onEnterLayer(\"ExitZones/\" + layerName).subscribe(() => {\n        triggerMessage = WA.ui.displayActionMessage({\n            message: \"Go to room ?\",\n            callback: () => {\n                WA.nav.goToRoom(url)\n            }\n        });\n    })\n    WA.room.onLeaveLayer(\"ExitZones/\" + layerName).subscribe(() => {\n        setTimeout(() => {\n            triggerMessage.remove();\n        }, 1000)\n    })\n}\n\nfunction setExitPrompt() {\n    for (let Group of map.layers)\n        if (Group.name === \"ExitZones\" && Group.type === \"group\" && Group?.layers != undefined) {\n            for (let Layer of Group.layers) {\n                if (Layer?.properties != undefined) {\n                    for (let property of Layer.properties) {\n                        if (property.name === \"exitUrl\" && property?.value != undefined && property.type === \"string\")\n                            declarePrompt(Layer.name, property.value)\n                    }\n                }\n            }\n        }\n}\n\nfunction hideAll() {\n    for (let Layer of map.layers) {\n        if (Layer.name != \"collisions\" && Layer.name != \"background\")\n            WA.room.hideLayer(Layer.name)\n    }\n}\n\nexport {};\n"],"names":["map","currareaprop","triggerMessage","bootstrap","hideAll","getAreaObjects","setAreaBehaviour","displayOnArrival","setExitPrompt","Layer","i","properties","property","Zone","Layers","isInArea","player_x","player_y","Object","position","declarePrompt","layerName","url","Group"],"mappings":"kEAaA,IAAIA,EACAC,EAAmC,CAAA,EACnCC,EAGJ,GAAG,OAAA,EAAS,KAAK,SAAW,CACdC,IAEJH,EAAA,MAAM,GAAG,KAAK,YAAY,EAExBI,IACOC,IACEC,IACAC,IACHC,GAElB,CAAC,EAAE,MAAM,GAAK,QAAQ,MAAM,CAAC,CAAC,EAO9B,SAASH,GAAiB,CACb,QAAAI,KAAST,EAAI,OAClB,GAAIS,EAAM,OAAS,aAAeA,EAAM,OAAS,cAAe,CAC5D,QAASC,EAAY,EAAGA,EAAID,EAAM,QAAQ,OAAQC,IAAK,CACnD,IAAIC,EAAaF,EAAM,QAAQC,CAAC,EAAE,WAClC,GAAID,EAAM,QAAQC,CAAC,EAAE,OAAS,QAAUC,GAAc,KAClD,QAASC,KAAYD,EACbC,EAAS,OAAS,oBAAqBA,GAAA,YAAAA,EAAU,QAAS,MAAaA,EAAS,OAAS,UACzFX,EAAa,KAAK,CAAC,KAAKQ,EAAM,QAAQC,CAAC,EAAE,KAAM,iBAAiBE,EAAS,MAAM,MAAM,GAAG,CAAE,CAAA,CAG1G,CACA,KACJ,CAER,CAGA,SAASN,GAAmB,CACxB,QAASO,KAAQZ,EACJ,QAAAa,KAAUD,EAAK,iBACpB,GAAG,KAAK,KAAK,QAAQA,EAAK,IAAI,EAAE,UAAU,IAAM,CACzC,GAAA,KAAK,UAAUC,CAAM,CAAA,CAC3B,EACD,GAAG,KAAK,KAAK,QAAQD,EAAK,IAAI,EAAE,UAAU,IAAM,CACzC,GAAA,KAAK,UAAUC,CAAM,CAAA,CAC3B,CAGb,CAEA,SAASC,EAASC,EAAkBC,EAAkBC,EAAc,CAChE,OAAIA,EAAO,EAAIF,GAAYA,EAAWE,EAAO,EAAIA,EAAO,OAASA,EAAO,EAAID,GAAYA,EAAWC,EAAO,EAAIA,EAAO,MAGzH,CAEA,eAAeX,GAAmB,CAC9B,IAAIY,EAAW,MAAM,GAAG,OAAO,YAAY,EAC3C,QAASN,KAAQZ,EAAc,CAC3B,IAAIiB,EAAS,MAAM,GAAG,KAAK,KAAK,IAAIL,EAAK,IAAI,EACzC,GAAAK,GAAU,MAAaH,EAASI,EAAS,EAAGA,EAAS,EAAGD,CAAM,EAAG,CACxD,QAAAJ,KAAUD,EAAK,iBACjB,GAAA,KAAK,UAAUC,CAAM,EAE5B,MACJ,CACJ,CACJ,CAEA,SAASM,EAAcC,EAAmBC,EAAa,CACnD,GAAG,KAAK,YAAY,aAAeD,EAAW,UAAW,MAAS,EAClE,GAAG,KAAK,aAAa,aAAeA,CAAS,EAAE,UAAU,IAAM,CAC1CnB,EAAA,GAAG,GAAG,qBAAqB,CACxC,QAAS,eACT,SAAU,IAAM,CACT,GAAA,IAAI,SAASoB,CAAG,CACvB,CAAA,CACH,CAAA,CACJ,EACD,GAAG,KAAK,aAAa,aAAeD,CAAS,EAAE,UAAU,IAAM,CAC3D,WAAW,IAAM,CACbnB,EAAe,OAAO,GACvB,GAAI,CAAA,CACV,CACL,CAEA,SAASM,GAAgB,CACrB,QAASe,KAASvB,EAAI,OACd,GAAAuB,EAAM,OAAS,aAAeA,EAAM,OAAS,UAAWA,GAAA,YAAAA,EAAO,SAAU,MAChE,QAAAd,KAASc,EAAM,OAChB,IAAAd,GAAA,YAAAA,EAAO,aAAc,KACZ,QAAAG,KAAYH,EAAM,WACnBG,EAAS,OAAS,YAAaA,GAAA,YAAAA,EAAU,QAAS,MAAaA,EAAS,OAAS,UACnEQ,EAAAX,EAAM,KAAMG,EAAS,KAAK,EAKpE,CAEA,SAASR,GAAU,CACN,QAAAK,KAAST,EAAI,OACdS,EAAM,MAAQ,cAAgBA,EAAM,MAAQ,cACzC,GAAA,KAAK,UAAUA,EAAM,IAAI,CAExC"}