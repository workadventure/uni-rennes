{"version":3,"file":"EGFeminisme-b5dc9702.js","sources":["../../src/EGFeminisme.ts"],"sourcesContent":["/// <reference types=\"@workadventure/iframe-api-typings\" />\nimport \"./main_new.js\";\n\nconsole.info('Script started successfully');\n\nWA.onInit().then(async() => {\n    WA.player.state.tutorialDone = true; // removing the tutorial\n    const url = new URL(WA.room.mapURL);\n\n    WA.room.onEnterLayer('to-hall').subscribe(() => { // removing buttons inherent to the room\n        WA.ui.actionBar.removeButton(\"Tableau\");\n        WA.ui.actionBar.removeButton(\"Briefing\");\n        WA.ui.banner.closeBanner();\n    });\n\n    for (let i = 1; i < 6; i++) { // Init variables\n        WA.player.state.saveVariable(`Enigme${i}`, 0, {public: true, persist: true, ttl: 60 * 35, scope: \"room\"});\n    }\n\n    // Ajout de l'écoute des variables des autres joueurs de la salle\n    WA.players.onVariableChange(\"Enigme1\").subscribe((event) => {WA.player.state.Enigme1 = event.value});\n    WA.players.onVariableChange(\"Enigme2\").subscribe((event) => {WA.player.state.Enigme2 = event.value});\n    WA.players.onVariableChange(\"Enigme3\").subscribe((event) => {WA.player.state.Enigme3 = event.value});\n    WA.players.onVariableChange(\"Enigme4\").subscribe((event) => {WA.player.state.Enigme4 = event.value});\n    WA.players.onVariableChange(\"Enigme5\").subscribe((event) => {WA.player.state.Enigme5 = event.value});\n\n    function enigmaCheck(zoneName :string) { // Ouvre l'enigme correspondant à la zone sur laquelle le joueur se trouve\n        WA.room.area.onEnter(zoneName).subscribe(() => {\n            WA.ui.modal.openModal({\n                title: zoneName,\n                src: `${url.protocol}//${url.host}${url.protocol === 'https:' ? \"/uni-rennes/\" : '/'}EGFeminisme/${zoneName}.html`, // ligne vaudou pour ouvrir le fichier html\n                allowApi: true,\n                allow: \"microphone; camera\",\n                position: \"center\",\n                allowFullScreen: false,\n            }, () => {\n                WA.ui.modal.closeModal();\n            });\n        });\n        WA.room.area.onLeave(zoneName).subscribe(() => {\n            WA.ui.modal.closeModal();\n        });\n    }\n\n    const enigmas = [\"E1\", \"E2\", \"E3\", \"E4\", \"E4B\", \"E5\", \"E6\"];\n    for (let enigma of enigmas) {\n        enigmaCheck(enigma);\n    }\n\n    await WA.ui.website.open({ // briefing video\n        url: \"https://www.youtube.com/embed/aFZ4mV52XFE?si=9vaLPfWDeUxbN3Xf&autoplay=1;&amp;controls=0&amp;\",\n        visible: true,\n        allowApi: false,\n        allowPolicy: \"autoplay\",\n        position: {\n            vertical: \"top\",\n            horizontal: \"right\",\n        },\n        size: {\n            height: \"20vh\",\n            width: \"20vw\",\n        },\n        margin: {\n            right: \"2vw\",\n            top: \"5vh\",\n        },\n    });\n\n    let toggle = true;\n    WA.ui.actionBar.addButton({ // Ajout du bouton du tableau de bord\n        id: \"Tableau\",\n        label: \"Tableau de bord\",\n        callback: async() => {\n            if (toggle) {\n                WA.ui.modal.openModal({\n                    title: \"Tableau de bord\",\n                    src: `${url.protocol}//${url.host}${url.protocol === 'https:'? \"/uni-rennes/\" : '/'}EGFeminisme/Tableau_de_bord.html`,\n                    allowApi: true,\n                    allow: \"\",\n                    position: \"center\",\n                    allowFullScreen: false,\n                }, () => {WA.ui.modal.closeModal();});\n            } else {\n                WA.ui.modal.closeModal();\n            }\n            toggle =!toggle;\n        }\n    });\n\n    const indices: string[] = [\n        \"1,2,3 Retracez l'histoire de la lutte féministe grâce à quelques grandes figures. N’oubliez pas le symbole de la relique\",\n        \"Le symbole de Vénus peut livrer ses mystères en morceaux.\",\n        \"Des questions à répondre pour un coffret à 3 chiffres à ouvrir ! N’oubliez pas le symbole de la relique !\",\n        \"Une clé à trouver… La bibliothèque pourrait-elle vous aider ? Enigme n°4… N’oubliez pas le symbole et le titre de la relique !\",\n        \"Deux groupes vont vous donner un code de 5 lettres. La relique de l’énigme n° 5 est un peu particulière...\"\n    ];\n\n    let i = 0;\n\n    function delay(ms: number): Promise<void> {\n        return new Promise((resolve) => setTimeout(resolve, ms));\n    }\n\n    function got_all_relics() {\n        for (let i = 1; i < 6; i++) {\n            if (WA.player.state.loadVariable(`Enigme${i}`) == 1) {\n                console.log(\"Player has variable\", WA.player.state.loadVariable(`Enigme${i}`));\n            }\n            if (WA.player.state.loadVariable(`Enigme${i}`) != 1) {\n                return false;\n            }\n        }\n        return true;\n    }\n\n    if (got_all_relics()) {\n        const x = 32 * 24;\n        const y = 32 * 15;\n        const w = 416; // 13 tuiles de large (13 * 32)\n        const h = w / (16 / 10);\n\n        console.log(x, y, h, w);\n\n        WA.room.website.create({\n            name: \"Salle2\",\n            url: `${url.protocol}//${url.host}${url.protocol === 'https:' ? \"/uni-rennes/\" : \"/\"}EGFeminisme/S2.html`,\n            position: { x: x - 28, y: y, width: w, height: h },\n            visible: true,\n            allowApi: false,\n            origin: \"map\",\n            scale: 1,\n        });\n        WA.camera.set(x + w / 2 + 32, y + h / 2 - 6, w, h, true, true);\n        WA.ui.banner.closeBanner();\n    } else {\n        console.error(\"WA API is not available.\");\n    }\n\n    while (true && !got_all_relics()) {\n        await delay(40000); // Wait for 30 seconds\n        WA.ui.banner.openBanner({\n            id: \"banner-test\",\n            text: indices[i % 4],\n            bgColor: \"#272727\",\n            textColor: \"#ffffff\",\n            closable: false,\n            timeToClose: 30 * 60 * 1000,\n        });\n        i++;\n    }\n});"],"names":["url","i","event","enigmaCheck","zoneName","enigmas","enigma","toggle","indices","delay","ms","resolve","got_all_relics"],"mappings":"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"}