{"version":3,"file":"extra-utilities-d8eb4fc0.js","sources":["../../src/extra-utilities.ts"],"sourcesContent":["/// <reference types=\"@workadventure/iframe-api-typings\" />\n\nimport { ActionMessage, Area, Position } from '@workadventure/iframe-api-typings';\nimport { areaobjects } from \"./extra-types\";\n\n/**\n * Returns an object from the array passed as argument if the name matches. The object msut have a \"name\" field for this to work.\n *\n * @param {Array<any>} array Array containing the desired object\n * @param {string} name Name of the desired object (contained in a \"name\" field)\n * @returns {any | undefined} Returns the first object with a matching name found in the array. If nothing matches, returns undefined.\n */\nexport function getObjectbyName(array: Array<any>, name: string): any {\n    if (array === undefined || array.length === 0)\n        return undefined;\n    for (let Object of array) {\n        if (\"name\" in Object && Object.name === name)\n            return Object;\n    }\n    return undefined;\n}\n/**\n * Returns an array of zones from a given object layer with their name and the content of a given property.\n *\n * @param {string} objectlayer Array of the zones\n * @param {string} linkedproperty Name of the given property\n * @returns {Array<areaobjects>} Returns the filled array of areaobjects\n */\nexport function getAreaObjects(objectlayer: string, linkedproperty: string, map: any): Array<areaobjects> {\n    let buf: Array<areaobjects> = [];\n    let layer = getObjectbyName(map.layers, objectlayer);\n    if (typeof layer === undefined || layer.type != \"objectgroup\")\n        return buf;\n    for (let object of layer.objects) {\n        let property = getObjectbyName(object.properties, linkedproperty);\n        if (property.value != undefined && property.type === \"string\") {\n            buf.push({name:object.name as string, associatedlayers:(property.value as string).split(\",\")});\n        }\n    }\n    return buf;\n}\n/**\n * Sets the display behavior for given areas.\n *\n * @param {Array<areaobjects>} displayareas Array containing the area's name and the layers that will be displayed with it.\n * @returns {void}\n */\nexport function setAreaDisplayBehaviour(displayareas: Array<areaobjects>): void {\n    for (let area of displayareas) {\n        for (let layer of area.associatedlayers) {\n            WA.room.area.onEnter(area.name).subscribe(() => {\n                WA.room.showLayer(layer);\n            });\n            WA.room.area.onLeave(area.name).subscribe(() => {\n                WA.room.hideLayer(layer);\n            });\n        }\n    }\n}\n/**\n * Checks if the player is in the area.\n *\n * @param {Position} player Position of the player\n * @param {Area} object Area you want to check\n * @returns {boolean} Returns true if the player is in the area\n */\nexport function isinArea(player: Position, object: Area): boolean {\n    if (object.x < player.x && player.x < object.x + object.width && object.y < player.y && player.y < object.y + object.height)\n        return true;\n    return false;\n}\n/**\n * Displays the layers associated with the area where the player is after arriving on the map (see onEnter behavior for reference).\n *\n * @param {Array<areaobjects>} displayareas Array of areaobjects for each display area\n * @returns {Promise<void>}\n */\nexport async function displayOnArrival(displayareas: Array<areaobjects>): Promise<void> {\n    let position = await WA.player.getPosition()\n    for (let area of displayareas) {\n        let object = await WA.room.area.get(area.name);\n        if (object != undefined && isinArea(position, object)) {\n            for (let layers of area.associatedlayers) {\n                WA.room.showLayer(layers);\n            }\n            return;\n        }\n    }\n}\n/**\n * Sets the prompt for an exit zone.\n *\n * @param {string} layername Name of the exit layer\n * @param {string} promptmessage Message that will be displayed on the prompt\n * @param {string} url Url of the room that you want to move to\n * @param {ActionMessage} triggerMessage Variable for the prompt object\n * @param {string | undefined} location If the exit layer is within a layer group, path to the group\n * @returns {void}\n */\nexport function setExitPrompt(layername: string, promptmessage: string, url: string, triggerMessage: ActionMessage, location?: string): void {\n    let path = location === undefined ? layername : location[location.length] === \"/\" ? location + layername : location + \"/\" + layername;\n    WA.room.onEnterLayer(path).subscribe(() => {\n        triggerMessage = WA.ui.displayActionMessage({\n            message: promptmessage,\n            callback: () => {\n                WA.nav.goToRoom(url);\n            }\n        });\n    });\n    WA.room.onLeaveLayer(path).subscribe(() => {\n        if (triggerMessage)\n            triggerMessage.remove();\n    });\n}\n/**\n * Sets all of the exit prompts for the layers of a layer group.\n *\n * @param {string} layergroup Path to the layer group\n * @param {string} exitproperty Name of the property containing the exit url\n * @param {string} exitmsgproperty Name of the property containing the message for the prompt\n * @param {ActionMessage} triggerMessage Variable for the prompt object\n * @param {any} map The current Tiled map (see the WA.room.getTiledMap() method)\n * @returns {void}\n */\nexport function setAllExitPrompts(layergroup: string, exitproperty: string, exitmsgproperty: string, triggerMessage: ActionMessage, map: any): void {\n    let group = getObjectbyName(map.layers, layergroup);\n    if (group === undefined || group.type != \"group\" || group.layers.length === 0)\n        return;\n    for (let layer of group.layers) {\n        let property = getObjectbyName(layer.properties, exitproperty);\n        let message = getObjectbyName(layer.properties, exitmsgproperty);\n        if (property != undefined && property.type === \"string\")\n            setExitPrompt(layer.name, (message != undefined ? message.value : \"Go to room ?\"), property.value, triggerMessage, layergroup);\n    }\n}\n/**\n * Hides every layer.\n *\n * @param {any} object The object that has the layers which must be hidden (must have a \"layers\" property)\n * @param {Array<string>} alwaysShown Array of the excluded layers\n * @returns {void}\n */\nexport function hideAll(object: any, alwaysShown: Array<string>): void {\n    if (!(\"layers\" in object))\n        return;\n    for (let layer of object.layers) {\n        if (alwaysShown.includes(layer.name) === false)\n            WA.room.hideLayer(layer.name);\n    }\n}\n\nexport default { getObjectbyName, getAreaObjects, setAreaDisplayBehaviour, isinArea, displayOnArrival, setExitPrompt, setAllExitPrompts, hideAll };\n"],"names":["getObjectbyName","array","name","Object","getAreaObjects","objectlayer","linkedproperty","map","buf","layer","object","property","setAreaDisplayBehaviour","displayareas","area","isinArea","player","displayOnArrival","position","layers","setExitPrompt","layername","promptmessage","url","triggerMessage","location","path","setAllExitPrompts","layergroup","exitproperty","exitmsgproperty","group","message","hideAll","alwaysShown","extraUtilities"],"mappings":"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"}