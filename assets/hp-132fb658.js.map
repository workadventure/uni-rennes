{"version":3,"file":"hp-132fb658.js","sources":["../../src/hp.ts"],"sourcesContent":["/// <reference types=\"@workadventure/iframe-api-typings\" />\n\nimport { ActionMessage } from \"@workadventure/iframe-api-typings\";\nimport * as extraUtils from \"./extra-utilities\";\nimport { areaobjects } from \"./extra-types\";\nimport \"./main_new.js\";\n\nconsole.log('Script started successfully');\n\nlet toggle : boolean = true;\n\n// Waiting for the API to be ready\nWA.onInit().then(async () => {\n\n    let triggerMessage!: ActionMessage;\n    let map = await WA.room.getTiledMap();\n    let EntryAreas : Array<areaobjects> = extraUtils.getAreaObjects(\"EntryAreas\", \"associatedLayers\", map);\n    let ExitAreas : Array<areaobjects> = extraUtils.getAreaObjects(\"ExitAreas\", \"associatedLayers\", map);\n\n    await setRoofDisplayonArrival(EntryAreas, ExitAreas);\n    setBuildingEntries(EntryAreas);\n    setBuildingExits(ExitAreas);\n    extraUtils.setAllExitPrompts(\"ExitZones\", \"exitPromptUrl\", \"exitPromptMessage\", triggerMessage, map)\n}).catch(e => console.error(e));\n\nasync function setRoofDisplayonArrival(EntryAreas : Array<areaobjects>, ExitAreas : Array<areaobjects>): Promise<void> {\n    let player = await WA.player.getPosition();\n    let currentarea!: areaobjects;\n    for (let areaobject of EntryAreas.concat(ExitAreas)) {\n        let area = await WA.room.area.get(areaobject.name);\n        if (extraUtils.isinArea(player, area)) {\n            currentarea = areaobject;\n            break;\n        }\n    }\n    if (!currentarea)\n        return;\n    if (EntryAreas.map(obj => obj.name).includes(currentarea.name)) {\n        for (let layer of currentarea.associatedlayers)\n            WA.room.hideLayer(layer);\n        toggle = false;\n        return;\n    }\n    //---- A décommenter si le toit commence caché sur la map et que isRoofVisible est false par défaut (et aussi commenter la partie du \"if\" précedent) ----\n    //if (ExitAreas.map(obj => obj.name).includes(currentarea.name)) {\n    //    for (let layer of currentarea.associatedlayers)\n    //        WA.room.showLayer(layer);\n    //    toggle = true;\n    //    return;\n    //}\n};\nfunction setBuildingExits(areas : Array<areaobjects>) {\n    for (let area of areas) {\n        WA.room.area.onEnter(area.name).subscribe(() => {\n            if (!toggle){\n                 for (let layer of area.associatedlayers)\n                    WA.room.showLayer(layer);\n                toggle = true;\n            }\n        });\n    }\n};\nfunction setBuildingEntries(areas : Array<areaobjects>) {\n    for (let area of areas) {\n        WA.room.area.onEnter(area.name).subscribe(() => {\n            if (toggle) {\n                for (let layer of area.associatedlayers)\n                    WA.room.hideLayer(layer);\n                toggle = false;\n            }\n        });\n    }\n};\n\nexport {};\n"],"names":["toggle","triggerMessage","map","EntryAreas","extraUtils.getAreaObjects","ExitAreas","setRoofDisplayonArrival","setBuildingEntries","setBuildingExits","extraUtils.setAllExitPrompts","e","player","currentarea","areaobject","area","extraUtils.isinArea","obj","layer","areas"],"mappings":"+FAOA,QAAQ,IAAI,6BAA6B,EAEzC,IAAIA,EAAmB,GAGvB,GAAG,OAAA,EAAS,KAAK,SAAY,CAErB,IAAAC,EACAC,EAAM,MAAM,GAAG,KAAK,YAAY,EAChCC,EAAkCC,EAA0B,aAAc,mBAAoBF,CAAG,EACjGG,EAAiCD,EAA0B,YAAa,mBAAoBF,CAAG,EAE7F,MAAAI,EAAwBH,EAAYE,CAAS,EACnDE,EAAmBJ,CAAU,EAC7BK,EAAiBH,CAAS,EAC1BI,EAA6B,YAAa,gBAAiB,oBAAqBR,EAAgBC,CAAG,CACvG,CAAC,EAAE,MAAMQ,GAAK,QAAQ,MAAMA,CAAC,CAAC,EAE9B,eAAeJ,EAAwBH,EAAiCE,EAA+C,CACnH,IAAIM,EAAS,MAAM,GAAG,OAAO,YAAY,EACrCC,EACJ,QAASC,KAAcV,EAAW,OAAOE,CAAS,EAAG,CACjD,IAAIS,EAAO,MAAM,GAAG,KAAK,KAAK,IAAID,EAAW,IAAI,EACjD,GAAIE,EAAoBJ,EAAQG,CAAI,EAAG,CACrBF,EAAAC,EACd,KACJ,CACJ,CACA,GAAKD,GAEDT,EAAW,IAAWa,GAAAA,EAAI,IAAI,EAAE,SAASJ,EAAY,IAAI,EAAG,CAC5D,QAASK,KAASL,EAAY,iBACvB,GAAA,KAAK,UAAUK,CAAK,EAClBjB,EAAA,GACT,MACJ,CAQJ,CACA,SAASQ,EAAiBU,EAA4B,CAClD,QAASJ,KAAQI,EACb,GAAG,KAAK,KAAK,QAAQJ,EAAK,IAAI,EAAE,UAAU,IAAM,CAC5C,GAAI,CAACd,EAAO,CACP,QAASiB,KAASH,EAAK,iBACjB,GAAA,KAAK,UAAUG,CAAK,EAClBjB,EAAA,EACb,CAAA,CACH,CAET,CACA,SAASO,EAAmBW,EAA4B,CACpD,QAASJ,KAAQI,EACb,GAAG,KAAK,KAAK,QAAQJ,EAAK,IAAI,EAAE,UAAU,IAAM,CAC5C,GAAId,EAAQ,CACR,QAASiB,KAASH,EAAK,iBAChB,GAAA,KAAK,UAAUG,CAAK,EAClBjB,EAAA,EACb,CAAA,CACH,CAET"}